library(tidytext)
library(tidyverse)

# poem from http://www.hungarianreference.com/Poems/Szabo-Lorinc-Szeretlek.aspx
hungarian_poem <- c("Szeretlek, szeretlek, szeretlek,", 
                    "egész nap kutatlak, kereslek,", 
                    "egész nap sírok a testedért,", 
                    "szomorú kedves a kedvesért,", 
                    "egész nap csókolom testedet,", 
                    "csókolom minden percedet.",
                    
                    "Minden percedet csókolom,", 
                    "nem múlik ízed az ajkamon,", 
                    "csókolom a földet, ahol jársz,", 
                    "csókolom a percet, mikor vársz,", 
                    "messziről kutatlak, kereslek,", 
                    "szeretlek, szeretlek, szeretlek.")

hungarian_poem <- c("Fekete országot álmodtam én,", 
                    "ahol minden fekete volt, ",
                    "minden fekete, de nem csak kívül:",
                    "csontig, velőig fekete,",
                    "fekete, ",
                    "fekete, fekete, fekete.",
                    
                    "Fekete ég és fekete tenger,",
                    "fekete fák és fekete ház,",
                    "fekete állat, fekete ember,",
                    "fekete öröm, fekete gyász,",
                    "fekete érc és fekete kő és",
                    "fekete föld és fekete fák,",
                    "fekete férfi, fekete nő és",
                    "fekete, fekete, fekete világ.",
                    
                    "Áshatod íme, vághatod egyre",
                    "az anyagot, mely lusta, tömör",
                    "fekete földbe, fekete hegybe",
                    "csap csak a csáklyád, fúr be furód:",
                    "s mélyre merítsd bár tintapatakját",
                    "még feketébben árad, ömöl",
                    "nézd a fü magját, nézd a fa makkját,",
                    "gerle tojását, csíragolyót,",
                    "fekete, fekete, fekete,",
                    "fekete kelme s fekete elme,",
                    "fekete arc és fekete gond,",
                    "fekete ér és fekete vér és",
                    "fekete velő és fekete csont.",
                    "Más szin a napfény vendég-máza,",
                    "a nap a színek piktora mind:",
                    "fekete bellül a földnek váza,",
                    "nem a fény festi a fekete szint",
                    "karcsu sugárecsetével",
                    "nem:",
                    "fekete az anyag rejtett lelke,",
                    "jaj,",
                    "fekete, fekete, fekete.")

hungarian_poem <- c("És mi mégis láncot hordtunk!",
                    "Ide veled, régi kardunk!",
                    "A magyarok istenére",
                    "Esküszünk,",
                    "Esküszünk, hogy rabok tovább",
                    "Nem leszünk!",
                    "",
                    "A magyar név megint szép lesz,",
                    "Méltó régi nagy hiréhez;",
                    "Mit rákentek a századok,",
                    "Lemossuk a gyalázatot!",
                    "A magyarok istenére",
                    "Esküszünk,",
                    "Esküszünk, hogy rabok tovább",
                    "Nem leszünk!",
                    "",
                    "Hol sírjaink domborulnak,",
                    "Unokáink leborulnak,",
                    "És áldó imádság mellett",
                    "Mondják el szent neveinket.",
                    "A magyarok istenére",
                    "Esküszünk,",
                    "Esküszünk, hogy rabok tovább",
                    "Nem leszünk!",
                    "Jobban ékesíti a kart,",
                    "És mi mégis láncot hordtunk!",
                    "Ide veled, régi kardunk!",
                    "A magyarok istenére",
                    "Esküszünk,",
                    "Esküszünk, hogy rabok tovább",
                    "Nem leszünk!",
                    "",
                    "A magyar név megint szép lesz,",
                    "Méltó régi nagy hiréhez;",
                    "Mit rákentek a századok,",
                    "Lemossuk a gyalázatot!",
                    "A magyarok istenére",
                    "Esküszünk,",
                    "Esküszünk, hogy rabok tovább",
                    "Nem leszünk!",
                    "",
                    "Hol sírjaink domborulnak,",
                    "Unokáink leborulnak,",
                    "És áldó imádság mellett",
                    "Mondják el szent neveinket.",
                    "A magyarok istenére",
                    "Esküszünk,",
                    "Esküszünk, hogy rabok tovább",
                    "Nem leszünk!",
                    "Talpra magyar, hí a haza!",
                    "Itt az idő, most vagy soha!",
                    "Rabok legyünk vagy szabadok?",
                    "Ez a kérdés, válasszatok! –",
                    "A magyarok istenére",
                    "Esküszünk,",
                    "Esküszünk, hogy rabok tovább",
                    "Nem leszünk!",
                    "",
                    "Rabok voltunk mostanáig,",
                    "Kárhozottak ősapáink,",
                    "Kik szabadon éltek-haltak,",
                    "Szolgaföldben nem nyughatnak.",
                    "A magyarok istenére",
                    "Esküszünk,",
                    "Esküszünk, hogy rabok tovább",
                    "Nem leszünk!",
                    "",
                    "Sehonnai bitang ember,",
                    "Ki most, ha kell, halni nem mer,",
                    "Kinek drágább rongy élete,",
                    "Mint a haza becsülete.",
                    "A magyarok istenére",
                    "Esküszünk,",
                    "Esküszünk, hogy rabok tovább",
                    "Nem leszünk!",
                    "",
                    "Fényesebb a láncnál a kard,",
                    "Jobban ékesíti a kart,",
                    "És mi mégis láncot hordtunk!",
                    "Ide veled, régi kardunk!",
                    "A magyarok istenére",
                    "Esküszünk,",
                    "Esküszünk, hogy rabok tovább",
                    "Nem leszünk!",
                    "",
                    "A magyar név megint szép lesz,",
                    "Méltó régi nagy hiréhez;",
                    "Mit rákentek a századok,",
                    "Lemossuk a gyalázatot!",
                    "A magyarok istenére",
                    "Esküszünk,",
                    "Esküszünk, hogy rabok tovább",
                    "Nem leszünk!",
                    "",
                    "Hol sírjaink domborulnak,",
                    "Unokáink leborulnak,",
                    "És áldó imádság mellett",
                    "Mondják el szent neveinket.",
                    "A magyarok istenére",
                    "Esküszünk,",
                    "Esküszünk, hogy rabok tovább",
                    "Nem leszünk!")

poem_df <- data_frame(line_number=1:length(hungarian_poem), body=hungarian_poem)

# hungarian stopwords from https://github.com/stopwords-iso/stopwords-hu/blob/master/stopwords-hu.txt
# sentiment dictionary from http://opendata.hu/hu/dataset/hungarian-sentiment-lexicon (thanks Anna May!)

hu_stop_word <- read_csv("data/stopwords-hu.txt")

positive_words <- read_csv("data/PrecoSenti/PrecoPos.txt") %>%
  mutate(sentiment=1)

negative_words <- read_csv("data/PrecoSenti/PrecoNeg.txt") %>%
  mutate(sentiment=-1)

hungarian_sentiment <- rbind(positive_words, negative_words)

tidy_poem <- poem_df %>%
  unnest_tokens(word, body) %>% 
  anti_join(hu_stop_word) %>%
  inner_join(hungarian_sentiment)

tidy_poem %>%
  count(word, sentiment) %>% mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n * sentiment, fill = sentiment)) + geom_col(show.legend = FALSE) +
  labs(y = "Contribution to sentiment", x = NULL) + coord_flip()



frequency <- words %>% 
  mutate(datum = year(datum),
         word = str_extract(word, "[a-z']+")) %>%
  count(datum, word) %>%
  group_by(datum) %>%
  mutate(proportion = n / sum(n)) %>% 
  select(-n) %>% 
  spread(datum, proportion) %>% 
  gather(datum, proportion, `2000`:`2001`)

library(scales)
ggplot(frequency, aes(x = proportion, y = `2002`, color = abs(`2002` - proportion))) +
  geom_abline(color = "gray40", lty = 2) +
  geom_jitter(alpha = 0.1, size = 2.5, width = 0.3, height = 0.3) +
  geom_text(aes(label = word), check_overlap = TRUE, vjust = 1.5) +
  scale_x_log10(labels = percent_format()) +
  scale_y_log10(labels = percent_format()) +
  scale_color_gradient(limits = c(0, 0.001), low = "darkslategray4", high = "gray75") +
  facet_wrap(~ datum, ncol = 2) +
  theme(legend.position="none") +
  labs(y = "2002", x = NULL)

